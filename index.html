<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI è¦–è¨Šæ·±å½æª¢æ¸¬åŠ©æ‰‹ | Deepfake Defense (æœ€çµ‚æ”¹è‰¯ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* ... (ä¿ç•™æ‰€æœ‰åŸæœ‰çš„ CSS æ¨£å¼) ... */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b; 
        }
        ::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; 
        }

        .radar-scan {
            position: relative;
            overflow: hidden;
        }
        .radar-scan::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, rgba(34, 197, 94, 0) 0%, rgba(34, 197, 94, 0.1) 50%, rgba(34, 197, 94, 0) 100%);
            animation: scan 3s linear infinite;
            pointer-events: none;
        }
        @keyframes scan {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }

        .risk-meter {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .checkbox-wrapper input:checked + div {
            /* å‹¾é¸æ™‚ä½¿ç”¨ç´…è‰²æˆ–å¼·èª¿è‰² */
            background-color: #ef4444; 
            border-color: #ef4444;
            color: white;
        }
        
        /* Video/Photo Upload Styles */
        .video-upload-area, .photo-upload-area-custom {
            border: 2px dashed #475569;
            transition: all 0.3s;
        }
        .video-upload-area:hover, .photo-upload-area-custom:hover {
            border-color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.05);
        }
        /* Style for the report details */
        #detection-report-details p[style*="green"] {
            background-color: rgba(16, 185, 129, 0.2); 
            color: #10b981; 
            padding: 8px;
            border-radius: 4px;
        }
        #detection-report-details p[style*="red"] {
            background-color: rgba(239, 68, 68, 0.2); 
            color: #ef4444; 
            padding: 8px;
            border-radius: 4px;
        }
        #detection-report-details ul {
            list-style-type: none;
            padding-left: 0;
            margin-top: 10px;
        }
        #detection-report-details li {
            padding: 5px 0;
            border-bottom: 1px dashed #334155; 
        }
        #detection-report-details li button {
             /* æ¨£å¼åŒ–æ™‚é–“æˆ³æŒ‰éˆ• */
            background-color: #1e293b;
            color: #3b82f6;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 10px;
            transition: background-color 0.3s;
        }
        #detection-report-details li button:hover {
            background-color: #3b82f6;
            color: white;
        }
        
        /* åœ–ç‰‡é è¦½æ¨£å¼ */
        #photo-preview-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
            background-color: #1e293b;
            border-radius: 8px;
            margin-top: 15px;
            overflow: hidden;
        }
        #uploaded-photo-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 6px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="bg-slate-900 border-b border-slate-700 px-6 py-4 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center space-x-3">
            <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center shadow-lg shadow-blue-500/30">
                <i class="fas fa-shield-alt text-white text-xl"></i>
            </div>
            <div>
                <h1 class="text-xl font-bold tracking-wide text-white">Deepfake Defense</h1>
                <p class="text-xs text-slate-400">AI å½±ç‰‡å¯©æ ¸å„€è¡¨æ¿ (æœ€çµ‚æ”¹è‰¯ç‰ˆ)</p>
            </div>
        </div>
        <div class="hidden md:flex items-center space-x-4">
            <span id="system-status" class="px-3 py-1 bg-slate-800 rounded text-sm text-slate-400 border border-slate-700">
                <i class="fas fa-circle text-green-500 text-[8px] mr-2"></i>ç³»çµ±å¾…å‘½
            </span>
        </div>
    </nav>

    <main class="flex-grow container mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6">

        <div class="lg:col-span-8 space-y-6">
            
            <div class="bg-slate-800 rounded-2xl p-4 shadow-xl border border-slate-700">
                <h2 class="text-lg font-semibold mb-3 text-slate-200 flex items-center">
                    <i class="fas fa-play-circle mr-2 text-red-400"></i> å½±ç‰‡é è¦½èˆ‡æ™‚é–“é»è·³è½‰
                </h2>
                <div class="aspect-video bg-black rounded-lg overflow-hidden">
                    <video id="video-player" controls class="w-full h-full" poster="https://via.placeholder.com/800x450.png?text=Upload+Video+to+Preview+Content">
                        æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ HTML5 å½±ç‰‡ã€‚
                    </video>
                </div>
                <p id="player-status" class="text-sm text-slate-400 mt-2">ä¸Šå‚³å½±ç‰‡å¾Œå°‡åœ¨æ­¤æ’­æ”¾ã€‚</p>
            </div>

            <div class="bg-slate-800 rounded-2xl p-6 shadow-xl border border-slate-700 relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10">
                    <i class="fas fa-exclamation-triangle text-9xl"></i>
                </div>
                
                <h2 class="text-lg font-semibold mb-4 text-slate-200 flex items-center">
                    <i class="fas fa-chart-line mr-2 text-blue-400"></i> ç•¶å‰é¢¨éšªè©•ä¼°
                </h2>

                <div class="flex flex-col md:flex-row items-center justify-between gap-8">
                    <div class="relative w-48 h-48 flex items-center justify-center">
                        <svg class="w-full h-full transform -rotate-90">
                            <circle cx="96" cy="96" r="88" stroke="currentColor" stroke-width="12" fill="transparent" class="text-slate-700" />
                            <circle id="risk-circle" cx="96" cy="96" r="88" stroke="currentColor" stroke-width="12" fill="transparent" 
                                    class="risk-meter text-green-500" 
                                    stroke-dasharray="552" 
                                    stroke-dashoffset="552"
                                    stroke-linecap="round" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center text-center">
                            <span id="risk-percentage" class="text-4xl font-bold text-white">0%</span>
                            <span id="risk-label" class="text-sm font-medium text-green-400 mt-1">æœªåˆ†æ</span>
                        </div>
                    </div>

                    <div class="flex-1 w-full">
                        <div class="bg-slate-900/50 rounded-lg p-4 border border-slate-700">
                            <h3 class="text-slate-400 text-sm uppercase tracking-wider mb-2">æª¢æ¸¬å»ºè­°</h3>
                            <p id="risk-advice" class="text-slate-200 leading-relaxed">
                                è«‹ä¸Šå‚³æ‚¨çš„å½±ç‰‡æª”æ¡ˆï¼Œç”± AI é€²è¡Œ Deepfake å’Œå…§å®¹å®‰å…¨å¯©æ ¸ã€‚
                            </p>
                        </div>
                        <div class="mt-4 flex gap-2">
                            <button onclick="resetChecklist()" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded text-sm transition text-slate-200">
                                <i class="fas fa-redo mr-1"></i> é‡ç½®å„€è¡¨æ¿
                            </button>
                            <button onclick="toggleInfoModal()" class="px-4 py-2 bg-blue-600/20 hover:bg-blue-600/30 text-blue-400 border border-blue-500/30 rounded text-sm transition">
                                <i class="fas fa-book mr-1"></i> è©³ç´°åŸç†
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>

        <div class="lg:col-span-4 space-y-6">

            <div class="bg-slate-800 rounded-2xl p-6 shadow-xl border border-slate-700 radar-scan">
                <h2 class="text-lg font-semibold mb-4 text-white flex items-center">
                    <i class="fas fa-upload mr-2 text-green-400"></i> å½±ç‰‡æª”æ¡ˆä¸Šå‚³
                </h2>
                <div class="video-upload-area flex flex-col items-center justify-center p-8 rounded-xl bg-slate-900/50 cursor-pointer" onclick="document.getElementById('videoUploadInput').click()">
                    <i class="fas fa-file-video text-5xl text-blue-500 mb-3"></i>
                    <p class="text-slate-400 font-medium">é»æ“Šæˆ–æ‹–æ›³å½±ç‰‡è‡³æ­¤</p>
                    <p id="upload-filename" class="text-xs text-slate-500 mt-1">[æ”¯æ´ mp4, mov, avi]</p>
                    <input type="file" id="videoUploadInput" accept="video/*" class="hidden" onchange="handleVideoUpload(event)">
                </div>
                <div id="upload-progress-container" class="mt-4 hidden">
                    <p class="text-sm text-slate-400 mb-1">ä¸Šå‚³é€²åº¦: <span id="upload-percentage">0%</span></p>
                    <div class="w-full bg-slate-700 rounded-full h-2.5">
                        <div id="upload-progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div class="bg-slate-800 rounded-2xl p-6 shadow-xl border border-slate-700">
                <h2 class="text-lg font-semibold mb-4 text-white flex items-center">
                    <i class="fas fa-camera mr-2 text-indigo-400"></i> çœŸå®¹ç´°ç¯€æ¯”å°
                </h2>
                <p class="text-sm text-slate-400 mb-4">
                    ä¸Šå‚³è¦ªå‹çš„*çœŸå¯¦ç…§ç‰‡*ï¼Œæ¯”å°è¦–è¨Šç•«é¢ä¸­çš„é»‘ç—£ã€è€³å»“å½¢ç‹€ã€ç‰™é½’ç­‰ç´°ç¯€ã€‚
                </p>
                
                <div class="photo-upload-area-custom flex flex-col items-center justify-center p-6 rounded-xl bg-slate-900/50 cursor-pointer" onclick="document.getElementById('photoUploadInput').click()">
                    <i class="fas fa-cloud-upload-alt text-4xl text-indigo-500 mb-2"></i>
                    <p class="text-slate-300 font-medium">é»æ“Šä¸Šå‚³çœŸå¯¦ç…§ç‰‡</p>
                    <p class="text-xs text-slate-500 mt-1">ç…§ç‰‡åƒ…åœ¨æœ¬æ©Ÿç€è¦½å™¨é¡¯ç¤ºï¼Œä¸æœƒä¸Šå‚³é›²ç«¯</p>
                    <input type="file" id="photoUploadInput" accept="image/*" class="hidden" onchange="handlePhotoUpload(event)">
                </div>
                
                <div id="photo-preview-container">
                    <img id="uploaded-photo-preview" src="https://via.placeholder.com/300x200?text=Photo+Preview" alt="ä¸Šå‚³ç…§ç‰‡é è¦½" class="opacity-50">
                </div>
            </div>

            <div class="bg-slate-800 rounded-2xl p-6 shadow-xl border border-slate-700">
                <h2 class="text-lg font-semibold mb-4 text-slate-200 flex items-center">
                    <i class="fas fa-microscope mr-2 text-red-400"></i> AI å¯©æ ¸è©³ç´°å ±å‘Š
                </h2>
                <div id="detection-report-details" class="bg-slate-900/50 p-4 rounded-lg text-slate-300 min-h-[100px]">
                    <p>å ±å‘Šçµæœå°‡åœ¨é€™è£¡é¡¯ç¤ºã€‚è«‹å…ˆä¸Šå‚³å½±ç‰‡ã€‚</p>
                </div>
            </div>
            
             <div class="bg-slate-800 rounded-2xl p-6 shadow-xl border border-slate-700">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-semibold text-slate-200 flex items-center">
                        <i class="fas fa-list-check mr-2 text-yellow-400"></i> äººå·¥æª¢æŸ¥è¼”åŠ©æ¸…å–®
                    </h2>
                </div>
                <div id="checklist-items" class="space-y-3">
                    <label class="checkbox-wrapper flex items-start cursor-pointer">
                        <input type="checkbox" class="hidden" data-risk="10">
                        <div class="w-full p-3 rounded-lg flex items-center justify-between bg-slate-900/50 border border-slate-700 hover:bg-slate-900 transition">
                            <span class="text-slate-300 text-sm"><i class="fas fa-eye mr-2 text-yellow-500"></i> çœ¼ç›é–ƒçˆé »ç‡ç•°å¸¸æˆ–çœ¼ç¥å‘†æ»¯</span>
                            <span class="text-xs text-slate-500">+10%</span>
                        </div>
                    </label>
                    <label class="checkbox-wrapper flex items-start cursor-pointer">
                        <input type="checkbox" class="hidden" data-risk="25">
                        <div class="w-full p-3 rounded-lg flex items-center justify-between bg-slate-900/50 border border-slate-700 hover:bg-slate-900 transition">
                            <span class="text-slate-300 text-sm"><i class="fas fa-volume-up mr-2 text-yellow-500"></i> è²éŸ³èˆ‡å˜´å‹ä¸åŒæ­¥æˆ–æœ‰æ©Ÿæ¢°æ„Ÿ</span>
                            <span class="text-xs text-slate-500">+25%</span>
                        </div>
                    </label>
                    <label class="checkbox-wrapper flex items-start cursor-pointer">
                        <input type="checkbox" class="hidden" data-risk="15">
                        <div class="w-full p-3 rounded-lg flex items-center justify-between bg-slate-900/50 border border-slate-700 hover:bg-slate-900 transition">
                            <span class="text-slate-300 text-sm"><i class="fas fa-lightbulb mr-2 text-yellow-500"></i> è‡‰éƒ¨é™°å½±ä¸è‡ªç„¶ï¼Œæˆ–é‚Šç·£æ¨¡ç³Š</span>
                            <span class="text-xs text-slate-500">+15%</span>
                        </div>
                    </label>
                </div>
            </div>
            
        </div>
    </main>

    <div id="info-modal" class="fixed inset-0 bg-black bg-opacity-70 z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-xl max-w-lg w-full p-6 border border-slate-700 shadow-2xl">
            <h3 class="text-xl font-bold mb-4 text-blue-400 flex items-center"><i class="fas fa-book mr-2"></i> æª¢æ¸¬åŸç†</h3>
            <p class="text-sm text-slate-300 leading-relaxed">
                æœ¬å¹³å°çµåˆäº† Google Cloud Video Intelligence API é€²è¡Œå…§å®¹å®‰å…¨å¯©æ ¸ (Safe Search Detection)ï¼Œå°ˆæ³¨æ–¼åµæ¸¬æˆäººã€æš´åŠ›ã€è¡€è…¥ç­‰æœ‰å®³å…§å®¹çš„é¢¨éšªã€‚
            </p>
            <p class="text-sm text-slate-300 leading-relaxed mt-2">
                åŒæ™‚ï¼Œæˆ‘å€‘ä½¿ç”¨å®¢è£½åŒ–çš„ AI æ¨¡å‹ï¼ˆå¾Œç«¯æ¨¡æ“¬ï¼‰ä¾†åˆ†æå½±ç‰‡çš„å¹€é–“ä¸€è‡´æ€§ã€çœ¼ç›ã€å˜´å”‡é‹å‹•å’Œå…‰ç…§ç•°å¸¸ï¼Œä¸¦çµåˆ*äººå·¥æª¢æŸ¥è¼”åŠ©æ¸…å–®*ï¼Œä»¥è­˜åˆ¥ Deepfake å½é€ çš„å¸¸è¦‹ç‰¹å¾µã€‚
            </p>
            <button onclick="toggleInfoModal()" class="mt-6 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded text-white text-sm transition">é—œé–‰</button>
        </div>
    </div>


    <script>
        const API_ENDPOINT = 'http://localhost:5000/api/analyze'; 
        const videoPlayer = document.getElementById('video-player');
        
        // *æ–°å¢*ï¼šå„²å­˜ AI åˆ†æå¾—å‡ºçš„åŸºç¤é¢¨éšªåˆ†æ•¸
        let baseAIRiskScore = 0; 

        // =================================================================
        // æ ¸å¿ƒé‚è¼¯å‡½æ•¸ï¼šæ›´æ–°å„€è¡¨æ¿ç‹€æ…‹
        // =================================================================
        function updateRiskMeter(percentage, label, colorClass, duration = 0.5) {
            // ç¢ºä¿åˆ†æ•¸ä¸è¶…é 100%
            const finalPercentage = Math.min(100, percentage); 

            const dashOffset = 552 * (1 - (finalPercentage / 100));
            const circle = document.getElementById('risk-circle');
            const riskPercentage = document.getElementById('risk-percentage');
            const riskLabel = document.getElementById('risk-label');

            circle.style.transitionDuration = ${duration}s;
            circle.style.strokeDashoffset = dashOffset;
            
            // æ ¹æ“šåˆ†æ•¸ç¯„åœç¢ºå®šé¡è‰²
            let finalColorClass;
            if (finalPercentage >= 70) {
                finalColorClass = 'text-red-500';
            } else if (finalPercentage >= 40) {
                finalColorClass = 'text-yellow-500';
            } else {
                finalColorClass = 'text-green-500';
            }

            circle.className = 'risk-meter ' + finalColorClass.replace('text-', 'text-');
            
            riskPercentage.textContent = ${finalPercentage}%;
            riskLabel.textContent = label;
            riskLabel.className = text-sm font-medium ${finalColorClass.replace('text-', 'text-')} mt-1;
        }
        
        // =================================================================
        // æ–°å¢ï¼šè¨ˆç®—äººå·¥æª¢æŸ¥ç´¯ç©é¢¨éšªä¸¦æ›´æ–°ç¸½åˆ†
        // =================================================================
        function calculateAndApplyManualRisk() {
            // 1. è¨ˆç®—æ‰‹å‹•é¢¨éšªç¸½å’Œ
            let manualRisk = 0;
            const checkboxes = document.querySelectorAll('#checklist-items input[type="checkbox"]');
            
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    // å°‡ data-risk å±¬æ€§å€¼ç´¯åŠ 
                    manualRisk += parseInt(cb.getAttribute('data-risk'), 10) || 0; 
                }
            });

            // 2. ç´¯åŠ ç¸½é¢¨éšª
            let totalRisk = baseAIRiskScore + manualRisk;

            // 3. æ ¹æ“šç¸½é¢¨éšªæ›´æ–°æ¨™ç±¤å’Œå»ºè­°
            let label = 'æ¥µä½é¢¨éšª';
            let advice = document.getElementById('risk-advice').textContent; // ä¿ç•™AIå»ºè­°

            if (totalRisk >= 70) {
                label = 'æ¥µé«˜é¢¨éšª';
                advice = "ğŸš¨ ç¸½é¢¨éšªæ¥µé«˜ï¼AI å’Œäººå·¥è¼”åŠ©æª¢æŸ¥å‡é¡¯ç¤ºé‡å¤§ç•°å¸¸ã€‚";
            } else if (totalRisk >= 40) {
                label = 'ä¸­åº¦é¢¨éšª';
                if (!document.getElementById('detection-report-details').innerHTML.includes('AI å¯©æ ¸æ¨™è¨˜')) {
                    // å¦‚æœ AI æ²’æ¨™è¨˜ï¼Œå‰‡æ‰‹å‹•æª¢æŸ¥è§¸ç™¼äº†ä¸­åº¦é¢¨éšª
                    advice = "âš  äººå·¥æª¢æŸ¥æ¨™è¨˜äº†å¤šé …ç•°å¸¸ã€‚è«‹çµåˆçœŸå®¹æ¯”å°é€²è¡Œè¤‡æ ¸ï¼";
                }
            } else {
                label = 'æ¥µä½é¢¨éšª';
            }

            // 4. æ›´æ–°å„€è¡¨æ¿
            updateRiskMeter(totalRisk, label, '', 0.3); // 0.3s å¹³æ»‘éæ¸¡
        }

        // =================================================================
        // API æ•´åˆå‡½æ•¸ï¼šè™•ç†æª”æ¡ˆä¸Šå‚³ä¸¦å‘¼å«å¾Œç«¯ (ä¿ç•™)
        // =================================================================
        async function handleVideoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // åœ¨æ–°çš„ä¸Šå‚³é–‹å§‹æ™‚ï¼Œé‡ç½®æ‰€æœ‰é¢¨éšªå’Œæ¸…å–®
            baseAIRiskScore = 0;
            resetChecklist(false); // ä¸é‡ç½®å½±ç‰‡æ’­æ”¾å™¨ï¼Œå› ç‚ºé¦¬ä¸Šå°±è¦è¨­å®š
            
            const statusDiv = document.getElementById('detection-report-details');
            const systemStatus = document.getElementById('system-status');
            const uploadFilename = document.getElementById('upload-filename');
            const progressBarContainer = document.getElementById('upload-progress-container');
            const progressBar = document.getElementById('upload-progress-bar');
            const progressPercentage = document.getElementById('upload-percentage');

            uploadFilename.textContent = file.name;
            progressBarContainer.classList.remove('hidden');

            videoPlayer.src = URL.createObjectURL(file);
            document.getElementById('player-status').textContent = æº–å‚™æ’­æ”¾ï¼š${file.name};


            updateRiskMeter(0, "ä¸Šå‚³ä¸­...", 'text-blue-500', 0.1);
            document.getElementById('risk-advice').textContent = "å½±ç‰‡æ­£åœ¨ä¸Šå‚³åˆ°ä¼ºæœå™¨ã€‚å®Œæˆå¾Œå°‡è‡ªå‹•å•Ÿå‹• AI åˆ†æã€‚";
            statusDiv.innerHTML = "<h4><i class='fas fa-upload fa-spin mr-2'></i> æª”æ¡ˆä¸Šå‚³ä¸­...</h4>";
            systemStatus.innerHTML = "<i class='fas fa-circle text-blue-500 text-[8px] mr-2'></i> ä¸Šå‚³ä¸­";
            
            const formData = new FormData();
            formData.append('videoFile', file); 

            const xhr = new XMLHttpRequest();
            xhr.open('POST', API_ENDPOINT, true);
            
            xhr.upload.onprogress = function(e) {
                // ... (ä¸Šå‚³é€²åº¦é‚è¼¯ä¸è®Š) ...
                if (e.lengthComputable) {
                    const percent = Math.round((e.loaded / e.total) * 100);
                    progressBar.style.width = percent + '%';
                    progressPercentage.textContent = percent + '%';
                    if (percent === 100) {
                        updateRiskMeter(0, "åˆ†æä¸­...", 'text-yellow-500', 0.1);
                        document.getElementById('risk-advice').textContent = "ä¸Šå‚³å®Œæˆï¼AI ä¼ºæœå™¨æ­£åœ¨é€²è¡Œæ·±åº¦åˆ†æï¼Œè«‹ç¨å€™...";
                        statusDiv.innerHTML = "<h4><i class='fas fa-spinner fa-spin mr-2'></i> AI åˆ†æè™•ç†ä¸­...</h4>";
                        systemStatus.innerHTML = "<i class='fas fa-circle text-yellow-500 text-[8px] mr-2'></i> åˆ†æä¸­";
                        progressBarContainer.classList.add('hidden');
                        
                    }
                }
            };
            
            xhr.onload = function() {
                if (xhr.status >= 200 && xhr.status < 300) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        if (data.status === 'success') {
                            processAIResults(data.report); 
                        } else {
                            handleAnalysisError(data.error || 'ä¼ºæœå™¨è¿”å›å¤±æ•—ç‹€æ…‹');
                        }
                    } catch (e) {
                         handleAnalysisError('ç„¡æ³•è§£æä¼ºæœå™¨éŸ¿æ‡‰ã€‚');
                    }
                } else {
                    handleAnalysisError(HTTP éŒ¯èª¤: ${xhr.status});
                }
            };

            xhr.onerror = function() {
                handleAnalysisError('ç¶²è·¯é€£ç·šå¤±æ•—æˆ–å¾Œç«¯ä¼ºæœå™¨æœªå•Ÿå‹•ã€‚');
            };

            xhr.send(formData);
        }

        // è™•ç† AI çµæœä¸¦æ›´æ–°å„€è¡¨æ¿ (ä¿®æ”¹ï¼šå„²å­˜åŸºç¤é¢¨éšªä¸¦å‘¼å«æ•´åˆå‡½æ•¸)
        function processAIResults(aiReportHtml) {
            let riskScore = 0;
            let advice = "AI å¯©æ ¸é€šéã€‚æœªåµæ¸¬åˆ°æœ‰å®³å…§å®¹æˆ–æ˜é¡¯ Deepfake è·¡è±¡ã€‚";

            if (aiReportHtml.includes('color: red')) {
                riskScore = Math.floor(Math.random() * 20) + 70; // 70-90%
                advice = "ğŸš¨ AI åµæ¸¬åˆ°é«˜é¢¨éšªç‰¹å¾µï¼è«‹ä»”ç´°æŸ¥çœ‹ä¸‹æ–¹å ±å‘Šä¸­çš„æ™‚é–“é»ï¼Œä¸¦é»æ“ŠæŒ‰éˆ•è·³è½‰ã€‚";
            } else if (aiReportHtml.includes('POSSIBLE')) {
                 riskScore = Math.floor(Math.random() * 20) + 40; // 40-60%
                advice = "ğŸ’¡ AI åµæ¸¬åˆ°ä¸­åº¦é¢¨éšªç‰¹å¾µã€‚å»ºè­°äººå·¥è¤‡æ ¸ç›¸é—œæ™‚é–“é»ã€‚";
            } else {
                riskScore = Math.floor(Math.random() * 15); // 0-15%
            }

            // *æ ¸å¿ƒä¿®æ”¹ 1ï¼šå„²å­˜ AI åŸºç¤åˆ†æ•¸*
            baseAIRiskScore = riskScore; 
            
            // *æ ¸å¿ƒä¿®æ”¹ 2ï¼šä½¿ç”¨æ•´åˆå‡½æ•¸æ›´æ–°å„€è¡¨æ¿*
            calculateAndApplyManualRisk(); 
            
            // æ›´æ–°æ–‡å­—å ±å‘Š
            document.getElementById('risk-advice').textContent = advice;
            document.getElementById('detection-report-details').innerHTML = <h4>AI å¯©æ ¸å ±å‘Š:</h4>${aiReportHtml};
            document.getElementById('system-status').innerHTML = "<i class='fas fa-circle text-green-500 text-[8px] mr-2'></i> ç³»çµ±å¾…å‘½";
            document.getElementById('player-status').textContent = åˆ†æå®Œæˆï¼ŒAI åŸºç¤é¢¨éšªåˆ†æ•¸ï¼š${riskScore}%;
        }
        
        // è™•ç†éŒ¯èª¤ (ä¿ç•™)
        function handleAnalysisError(errorMessage) {
            baseAIRiskScore = 0;
            updateRiskMeter(0, 'éŒ¯èª¤', 'text-slate-400', 0);
            document.getElementById('risk-advice').innerHTML = <p class="text-red-500">${errorMessage}</p>;
            document.getElementById('detection-report-details').innerHTML = <p class='text-red-500'>ç„¡æ³•å–å¾—åˆ†æçµæœï¼ŒéŒ¯èª¤ï¼š${errorMessage}</p>;
            document.getElementById('system-status').innerHTML = "<i class='fas fa-circle text-red-500 text-[8px] mr-2'></i> éŒ¯èª¤";
            document.getElementById('upload-progress-container').classList.add('hidden');
        }

        // è™•ç†æœ¬åœ°ç…§ç‰‡ä¸Šå‚³ä¸¦é è¦½ (ä¿ç•™)
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            if (!file.type.match('image.*')) {
                alert("è«‹é¸æ“‡åœ–ç‰‡æª”æ¡ˆï¼");
                return;
            }

            const reader = new FileReader();
            
            reader.onload = function(e) {
                const previewImg = document.getElementById('uploaded-photo-preview');
                previewImg.src = e.target.result;
                previewImg.classList.remove('opacity-50');
                
                document.getElementById('risk-advice').textContent = "ğŸ“¸ çœŸå¯¦ç…§ç‰‡å·²è¼‰å…¥ã€‚è«‹æ‰‹å‹•æ¯”å°å½±ç‰‡ä¸­çš„è‡‰éƒ¨ç´°ç¯€ã€‚";
            };
            reader.readAsDataURL(file);
        }


        // =================================================================
        // è¼”åŠ©èˆ‡äº’å‹•å‡½æ•¸
        // =================================================================
        window.jumpTo = function(seconds) {
            if (videoPlayer.src) {
                videoPlayer.currentTime = seconds;
                videoPlayer.play();
                document.getElementById('player-status').textContent = è·³è½‰åˆ°æ¨™è¨˜æ™‚é–“é»: ${seconds} ç§’;
            } else {
                alert("è«‹å…ˆä¸Šå‚³å½±ç‰‡ï¼");
            }
        }

        function toggleInfoModal() {
            const modal = document.getElementById('info-modal');
            modal.classList.toggle('hidden');
        }

        // é‡ç½®å‡½æ•¸ (ä¿®æ”¹ï¼šå¢åŠ åƒæ•¸æ§åˆ¶æ˜¯å¦é‡ç½®å½±ç‰‡æ’­æ”¾å™¨)
        function resetChecklist(resetVideo = true) {
            baseAIRiskScore = 0; // é‡ç½®åŸºç¤é¢¨éšª
            updateRiskMeter(0, 'æœªåˆ†æ', 'text-green-400', 0.5);
            document.getElementById('risk-advice').textContent = "è«‹ä¸Šå‚³æ‚¨çš„å½±ç‰‡æª”æ¡ˆï¼Œç”± AI é€²è¡Œ Deepfake å’Œå…§å®¹å®‰å…¨å¯©æ ¸ã€‚";
            document.getElementById('detection-report-details').innerHTML = "<p>å ±å‘Šçµæœå°‡åœ¨é€™è£¡é¡¯ç¤ºã€‚è«‹å…ˆä¸Šå‚³å½±ç‰‡ã€‚</p>";
            document.getElementById('upload-filename').textContent = "[æ”¯æ´ mp4, mov, avi]";
            document.getElementById('upload-progress-container').classList.add('hidden');
            
            if (resetVideo) {
                videoPlayer.src = '';
                document.getElementById('player-status').textContent = "ä¸Šå‚³å½±ç‰‡å¾Œå°‡åœ¨æ­¤æ’­æ”¾ã€‚";
            }
            
            const previewImg = document.getElementById('uploaded-photo-preview');
            previewImg.src = "https://via.placeholder.com/300x200?text=Photo+Preview";
            previewImg.classList.add('opacity-50');
            
            const checkboxes = document.querySelectorAll('#checklist-items input[type="checkbox"]');
            checkboxes.forEach(cb => {
                cb.checked = false;
            });
            document.getElementById('system-status').innerHTML = "<i class='fas fa-circle text-green-500 text-[8px] mr-2'></i> ç³»çµ±å¾…å‘½";
        }

        // *æ ¸å¿ƒä¿®æ”¹ 3ï¼šç‚ºæ‰€æœ‰æ¸…å–®é …ç›®å¢åŠ äº‹ä»¶ç›£è½*
        document.querySelectorAll('#checklist-items input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', calculateAndApplyManualRisk);
        });

        window.onload = resetChecklist;
    </script>
</body>
</html>
