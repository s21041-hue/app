<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI è¦–è¨Šæ·±å½æª¢æ¸¬åŠ©æ‰‹ | Deepfake Defense</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b; 
        }
        ::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; 
        }

        .radar-scan {
            position: relative;
            overflow: hidden;
        }
        .radar-scan::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, rgba(34, 197, 94, 0) 0%, rgba(34, 197, 94, 0.1) 50%, rgba(34, 197, 94, 0) 100%);
            animation: scan 3s linear infinite;
            pointer-events: none;
        }
        @keyframes scan {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }

        .risk-meter {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .checkbox-wrapper input:checked + div {
            background-color: #ef4444;
            border-color: #ef4444;
            color: white;
        }
        
        .pulse-red {
            animation: pulse-red 2s infinite;
        }
        
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        /* Video Upload Styles */
        .video-upload-area {
            border: 2px dashed #475569;
            transition: all 0.3s;
        }
        .video-upload-area:hover {
            border-color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.05);
        }
        /* Style for the report details */
        #detection-report-details p[style*="green"] {
            background-color: rgba(16, 185, 129, 0.2); /* green-500/20 */
            color: #10b981; /* green-500 */
            padding: 8px;
            border-radius: 4px;
        }
        #detection-report-details p[style*="red"] {
            background-color: rgba(239, 68, 68, 0.2); /* red-500/20 */
            color: #ef4444; /* red-500 */
            padding: 8px;
            border-radius: 4px;
        }
        #detection-report-details ul {
            list-style-type: none;
            padding-left: 0;
            margin-top: 10px;
        }
        #detection-report-details li {
            padding: 5px 0;
            border-bottom: 1px dashed #334155; /* slate-700 */
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="bg-slate-900 border-b border-slate-700 px-6 py-4 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center space-x-3">
            <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center shadow-lg shadow-blue-500/30">
                <i class="fas fa-shield-alt text-white text-xl"></i>
            </div>
            <div>
                <h1 class="text-xl font-bold tracking-wide text-white">Deepfake Defense</h1>
                <p class="text-xs text-slate-400">AI å½±ç‰‡å¯©æ ¸å„€è¡¨æ¿</p>
            </div>
        </div>
        <div class="hidden md:flex items-center space-x-4">
            <span id="system-status" class="px-3 py-1 bg-slate-800 rounded text-sm text-slate-400 border border-slate-700">
                <i class="fas fa-circle text-green-500 text-[8px] mr-2"></i>ç³»çµ±å¾…å‘½
            </span>
        </div>
    </nav>

    <main class="flex-grow container mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6">

        <div class="lg:col-span-8 space-y-6">
            
            <div class="bg-slate-800 rounded-2xl p-6 shadow-xl border border-slate-700 relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10">
                    <i class="fas fa-exclamation-triangle text-9xl"></i>
                </div>
                
                <h2 class="text-lg font-semibold mb-4 text-slate-200 flex items-center">
                    <i class="fas fa-chart-line mr-2 text-blue-400"></i> ç•¶å‰é¢¨éšªè©•ä¼°
                </h2>

                <div class="flex flex-col md:flex-row items-center justify-between gap-8">
                    <div class="relative w-48 h-48 flex items-center justify-center">
                        <svg class="w-full h-full transform -rotate-90">
                            <circle cx="96" cy="96" r="88" stroke="currentColor" stroke-width="12" fill="transparent" class="text-slate-700" />
                            <circle id="risk-circle" cx="96" cy="96" r="88" stroke="currentColor" stroke-width="12" fill="transparent" 
                                    class="risk-meter text-green-500" 
                                    stroke-dasharray="552" 
                                    stroke-dashoffset="552"
                                    stroke-linecap="round" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center text-center">
                            <span id="risk-percentage" class="text-4xl font-bold text-white">0%</span>
                            <span id="risk-label" class="text-sm font-medium text-green-400 mt-1">æœªåˆ†æ</span>
                        </div>
                    </div>

                    <div class="flex-1 w-full">
                        <div class="bg-slate-900/50 rounded-lg p-4 border border-slate-700">
                            <h3 class="text-slate-400 text-sm uppercase tracking-wider mb-2">æª¢æ¸¬å»ºè­°</h3>
                            <p id="risk-advice" class="text-slate-200 leading-relaxed">
                                è«‹ä¸Šå‚³æ‚¨çš„å½±ç‰‡æª”æ¡ˆï¼Œç”± AI é€²è¡Œ Deepfake å’Œå…§å®¹å®‰å…¨å¯©æ ¸ã€‚
                            </p>
                        </div>
                        <div class="mt-4 flex gap-2">
                            <button onclick="resetChecklist()" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded text-sm transition text-slate-200">
                                <i class="fas fa-redo mr-1"></i> é‡ç½®å„€è¡¨æ¿
                            </button>
                            <button onclick="toggleInfoModal()" class="px-4 py-2 bg-blue-600/20 hover:bg-blue-600/30 text-blue-400 border border-blue-500/30 rounded text-sm transition">
                                <i class="fas fa-book mr-1"></i> è©³ç´°åŸç†
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-slate-800 rounded-2xl p-6 shadow-xl border border-slate-700">
                <h2 class="text-lg font-semibold mb-4 text-slate-200 flex items-center">
                    <i class="fas fa-microscope mr-2 text-red-400"></i> AI å¯©æ ¸è©³ç´°å ±å‘Š
                </h2>
                <div id="detection-report-details" class="bg-slate-900/50 p-4 rounded-lg text-slate-300 min-h-[100px]">
                    <p>å ±å‘Šçµæœå°‡åœ¨é€™è£¡é¡¯ç¤ºã€‚è«‹å…ˆä¸Šå‚³å½±ç‰‡ã€‚</p>
                </div>
            </div>
            
        </div>

        <div class="lg:col-span-4 space-y-6">

            <div class="bg-slate-800 rounded-2xl p-6 shadow-xl border border-slate-700 radar-scan">
                <h2 class="text-lg font-semibold mb-4 text-white flex items-center">
                    <i class="fas fa-upload mr-2 text-green-400"></i> å½±ç‰‡æª”æ¡ˆä¸Šå‚³
                </h2>
                <div class="video-upload-area flex flex-col items-center justify-center p-8 rounded-xl bg-slate-900/50 cursor-pointer" onclick="document.getElementById('videoUploadInput').click()">
                    <i class="fas fa-file-video text-5xl text-blue-500 mb-3"></i>
                    <p class="text-slate-400 font-medium">é»æ“Šæˆ–æ‹–æ›³å½±ç‰‡è‡³æ­¤</p>
                    <p id="upload-filename" class="text-xs text-slate-500 mt-1">[æ”¯æ´ mp4, mov, avi]</p>
                    <input type="file" id="videoUploadInput" accept="video/*" class="hidden" onchange="handleVideoUpload(event)">
                </div>
            </div>

            <div class="bg-slate-800 rounded-2xl p-6 shadow-xl border border-slate-700">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-semibold text-slate-200 flex items-center">
                        <i class="fas fa-list-check mr-2 text-yellow-400"></i> äººå·¥æª¢æŸ¥è¼”åŠ©æ¸…å–®
                    </h2>
                </div>
                <div id="checklist-items" class="space-y-3">
                    <label class="checkbox-wrapper flex items-start cursor-pointer">
                        <input type="checkbox" class="hidden" data-risk="10">
                        <div class="w-full p-3 rounded-lg flex items-center justify-between bg-slate-900/50 border border-slate-700 hover:bg-slate-900 transition">
                            <span class="text-slate-300 text-sm"><i class="fas fa-eye mr-2 text-yellow-500"></i> çœ¼ç›é–ƒçˆé »ç‡ç•°å¸¸æˆ–çœ¼ç¥å‘†æ»¯</span>
                            <span class="text-xs text-slate-500">+10%</span>
                        </div>
                    </label>
                    <label class="checkbox-wrapper flex items-start cursor-pointer">
                        <input type="checkbox" class="hidden" data-risk="25">
                        <div class="w-full p-3 rounded-lg flex items-center justify-between bg-slate-900/50 border border-slate-700 hover:bg-slate-900 transition">
                            <span class="text-slate-300 text-sm"><i class="fas fa-volume-up mr-2 text-yellow-500"></i> è²éŸ³èˆ‡å˜´å‹ä¸åŒæ­¥æˆ–æœ‰æ©Ÿæ¢°æ„Ÿ</span>
                            <span class="text-xs text-slate-500">+25%</span>
                        </div>
                    </label>
                    <label class="checkbox-wrapper flex items-start cursor-pointer">
                        <input type="checkbox" class="hidden" data-risk="15">
                        <div class="w-full p-3 rounded-lg flex items-center justify-between bg-slate-900/50 border border-slate-700 hover:bg-slate-900 transition">
                            <span class="text-slate-300 text-sm"><i class="fas fa-lightbulb mr-2 text-yellow-500"></i> è‡‰éƒ¨é™°å½±ä¸è‡ªç„¶ï¼Œæˆ–é‚Šç·£æ¨¡ç³Š</span>
                            <span class="text-xs text-slate-500">+15%</span>
                        </div>
                    </label>
                </div>
            </div>
            
        </div>
    </main>

    <div id="info-modal" class="fixed inset-0 bg-black bg-opacity-70 z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-xl max-w-lg w-full p-6 border border-slate-700 shadow-2xl">
            <h3 class="text-xl font-bold mb-4 text-blue-400 flex items-center"><i class="fas fa-book mr-2"></i> æª¢æ¸¬åŸç†</h3>
            <p class="text-sm text-slate-300 leading-relaxed">
                æœ¬å¹³å°çµåˆäº† Google Cloud Video Intelligence API é€²è¡Œå…§å®¹å®‰å…¨å¯©æ ¸ (Safe Search Detection)ï¼Œå°ˆæ³¨æ–¼åµæ¸¬æˆäººã€æš´åŠ›ã€è¡€è…¥ç­‰æœ‰å®³å…§å®¹çš„é¢¨éšªã€‚
            </p>
            <p class="text-sm text-slate-300 leading-relaxed mt-2">
                åŒæ™‚ï¼Œæˆ‘å€‘ä½¿ç”¨å®¢è£½åŒ–çš„ AI æ¨¡å‹ï¼ˆå¾Œç«¯æ¨¡æ“¬ï¼‰ä¾†åˆ†æå½±ç‰‡çš„å¹€é–“ä¸€è‡´æ€§ã€çœ¼ç›ã€å˜´å”‡é‹å‹•å’Œå…‰ç…§ç•°å¸¸ï¼Œä»¥è­˜åˆ¥ Deepfake å½é€ çš„å¸¸è¦‹ç‰¹å¾µã€‚
            </p>
            <button onclick="toggleInfoModal()" class="mt-6 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded text-white text-sm transition">é—œé–‰</button>
        </div>
    </div>


    <script>
        const API_ENDPOINT = 'http://localhost:5000/api/analyze'; 

        // =================================================================
        // æ ¸å¿ƒé‚è¼¯å‡½æ•¸ï¼šæ›´æ–°å„€è¡¨æ¿ç‹€æ…‹
        // =================================================================
        function updateRiskMeter(percentage, label, colorClass, duration = 0.5) {
            const dashOffset = 552 * (1 - (percentage / 100));
            const circle = document.getElementById('risk-circle');
            const riskPercentage = document.getElementById('risk-percentage');
            const riskLabel = document.getElementById('risk-label');

            // è¨­ç½®éæ¸¡æ™‚é–“
            circle.style.transitionDuration = ${duration}s;
            
            // æ›´æ–°å„€è¡¨
            circle.style.strokeDashdashoffset = dashOffset;
            
            // é‡ç½®é¡åˆ¥ä¸¦æ·»åŠ æ–°é¡åˆ¥
            circle.className = 'risk-meter ' + colorClass.replace('text-', 'text-');
            
            // æ›´æ–°æ–‡å­—
            riskPercentage.textContent = ${percentage}%;
            riskLabel.textContent = label;
            riskLabel.className = text-sm font-medium ${colorClass.replace('text-', 'text-')} mt-1;
        }
        
        // =================================================================
        // API æ•´åˆå‡½æ•¸ï¼šè™•ç†æª”æ¡ˆä¸Šå‚³ä¸¦å‘¼å«å¾Œç«¯
        // =================================================================
        async function handleVideoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const statusDiv = document.getElementById('detection-report-details');
            const systemStatus = document.getElementById('system-status');
            const uploadFilename = document.getElementById('upload-filename');

            uploadFilename.textContent = file.name;

            // 1. é¡¯ç¤ºè™•ç†ä¸­ç‹€æ…‹
            updateRiskMeter(0, "åˆ†æä¸­...", 'text-yellow-500', 0.5);
            document.getElementById('risk-advice').textContent = "å½±ç‰‡å·²ä¸Šå‚³ï¼Œæ­£åœ¨ç”± AI ä¼ºæœå™¨é€²è¡Œæ·±åº¦åˆ†æï¼Œé€™å¯èƒ½éœ€è¦å¹¾åˆ†é˜çš„æ™‚é–“...";
            statusDiv.innerHTML = "<h4><i class='fas fa-spinner fa-spin mr-2'></i> æ­£åœ¨ç­‰å¾… AI ä¼ºæœå™¨éŸ¿æ‡‰...</h4>";
            systemStatus.innerHTML = "<i class='fas fa-circle text-yellow-500 text-[8px] mr-2'></i> åˆ†æä¸­";
            
            // 2. æº–å‚™ FormData
            const formData = new FormData();
            formData.append('videoFile', file); 

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    body: formData,
                });

                const data = await response.json();
                
                if (response.ok && data.status === 'success') {
                    // 3. è™•ç†æˆåŠŸçš„çµæœ
                    processAIResults(data.report); 
                } else {
                    // è™•ç† API éŒ¯èª¤
                    handleAnalysisError(data.error || HTTP éŒ¯èª¤: ${response.status});
                }
            } catch (error) {
                // è™•ç†ç¶²è·¯éŒ¯èª¤
                handleAnalysisError('ç¶²è·¯é€£ç·šå¤±æ•—æˆ–å¾Œç«¯ä¼ºæœå™¨æœªå•Ÿå‹•ã€‚');
            }
        }

        // æ ¹æ“šå¾Œç«¯è¿”å›çš„çµæœæ›´æ–°å„€è¡¨æ¿
        function processAIResults(aiReportHtml) {
            let riskScore = 0;
            let advice = "AI å¯©æ ¸é€šéã€‚æœªåµæ¸¬åˆ°æœ‰å®³å…§å®¹æˆ–æ˜é¡¯ Deepfake è·¡è±¡ã€‚";
            let colorClass = 'text-green-500';
            let label = 'æ¥µä½é¢¨éšª';

            // æ ¹æ“šå¾Œç«¯è¿”å›çš„ HTML å…§å®¹åˆ¤æ–·é¢¨éšªç´šåˆ¥
            if (aiReportHtml.includes('color: red')) {
                riskScore = Math.floor(Math.random() * 30) + 70; // 70-100%
                advice = "ğŸš¨ AI åµæ¸¬åˆ°é«˜é¢¨éšªç‰¹å¾µ (ä¾‹å¦‚ï¼šæš´åŠ›ã€æˆäººå…§å®¹æˆ– Deepfake è·¡è±¡)ï¼è«‹ä»”ç´°æŸ¥çœ‹ä¸‹æ–¹å ±å‘Šä¸­çš„æ™‚é–“é»ã€‚";
                colorClass = 'text-red-500';
                label = 'é«˜é¢¨éšª';
            } else if (aiReportHtml.includes('POSSIBLE')) {
                 riskScore = Math.floor(Math.random() * 30) + 40; // 40-70%
                advice = "ğŸ’¡ AI åµæ¸¬åˆ°ä¸­åº¦é¢¨éšªç‰¹å¾µã€‚å»ºè­°äººå·¥è¤‡æ ¸ç›¸é—œæ™‚é–“é»ã€‚";
                colorClass = 'text-yellow-500';
                label = 'ä¸­åº¦é¢¨éšª';
            } else {
                riskScore = Math.floor(Math.random() * 20); // 0-20%
            }

            // æ›´æ–°å„€è¡¨æ¿
            updateRiskMeter(riskScore, label, colorClass, 1.0); 
            document.getElementById('risk-advice').textContent = advice;
            document.getElementById('detection-report-details').innerHTML = <h4>AI å¯©æ ¸å ±å‘Š:</h4>${aiReportHtml};
            document.getElementById('system-status').innerHTML = "<i class='fas fa-circle text-green-500 text-[8px] mr-2'></i> ç³»çµ±å¾…å‘½";
        }

        function handleAnalysisError(errorMessage) {
            updateRiskMeter(0, 'éŒ¯èª¤', 'text-slate-400', 0);
            document.getElementById('risk-advice').innerHTML = <p class="text-red-500">${errorMessage}</p>;
            document.getElementById('detection-report-details').innerHTML = <p class='text-red-500'>ç„¡æ³•å–å¾—åˆ†æçµæœï¼ŒéŒ¯èª¤ï¼š${errorMessage}</p>;
            document.getElementById('system-status').innerHTML = "<i class='fas fa-circle text-red-500 text-[8px] mr-2'></i> éŒ¯èª¤";
        }

        // =================================================================
        // è¼”åŠ©èˆ‡äº’å‹•å‡½æ•¸ (å¾åŸå§‹ç¨‹å¼ç¢¼ä¿ç•™)
        // =================================================================
        function toggleInfoModal() {
            const modal = document.getElementById('info-modal');
            modal.classList.toggle('hidden');
        }

        function resetChecklist() {
            // é‡ç½®å„€è¡¨æ¿ç‹€æ…‹
            updateRiskMeter(0, 'æœªåˆ†æ', 'text-green-400', 0.5);
            document.getElementById('risk-advice').textContent = "è«‹ä¸Šå‚³æ‚¨çš„å½±ç‰‡æª”æ¡ˆï¼Œç”± AI é€²è¡Œ Deepfake å’Œå…§å®¹å®‰å…¨å¯©æ ¸ã€‚";
            document.getElementById('detection-report-details').innerHTML = "<p>å ±å‘Šçµæœå°‡åœ¨é€™è£¡é¡¯ç¤ºã€‚è«‹å…ˆä¸Šå‚³å½±ç‰‡ã€‚</p>";
            document.getElementById('upload-filename').textContent = "[æ”¯æ´ mp4, mov, avi]";
            
            // é‡ç½®æ‰‹å‹•æª¢æŸ¥æ¸…å–®
            const checkboxes = document.querySelectorAll('#checklist-items input[type="checkbox"]');
            checkboxes.forEach(cb => {
                cb.checked = false;
            });
            // ç¢ºä¿ç³»çµ±ç‹€æ…‹ç‚ºå¾…å‘½
            document.getElementById('system-status').innerHTML = "<i class='fas fa-circle text-green-500 text-[8px] mr-2'></i> ç³»çµ±å¾…å‘½";
        }

        // åˆå§‹åŒ–ï¼šè¨­ç½®äº‹ä»¶ç›£è½å™¨ä»¥æ›´æ–°æ‰‹å‹•é¢¨éšªåˆ†æ•¸
        document.querySelectorAll('#checklist-items input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                // é€™è£¡æˆ‘å€‘ä¸å†ä¾è³´æ‰‹å‹•æ¸…å–®ä¾†æ±ºå®š AI çµæœï¼Œåƒ…ä¿ç•™å…¶è¦–è¦ºæ•ˆæœ
            });
        });
        
        // åˆå§‹è¼‰å…¥æ™‚èª¿ç”¨ä¸€æ¬¡é‡ç½®
        window.onload = resetChecklist;
    </script>
</body>
</html>
